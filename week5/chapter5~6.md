# 🚀 Node.js 교과서 5장 & 6장

---

## 📌 1. 기본 및 패키지 관리

* **npm:** Node Package Manager로, 모듈과 의존 관계를 관리한다.
* **의존 관계:** 한 모듈이 다른 모듈을 사용하는 관계를 의미한다.
* **패키지 이름 제약:** 기존에 존재하는 유명 패키지 이름(예: `express`)은 사용하지 않아야 한다.
* **`--save-dev`:** 개발용 의존성 패키지를 설치하며, `package.json`의 `devDependencies`에 기록된다.
* **버전 설치:** `@<version>`으로 특정 버전을 설치하며, `latest`는 가장 안정된 버전을 의미한다.

---

## 🌐 2. Express와 미들웨어

* **Express.js:** Node.js 기반의 웹 서버 프레임워크로, 서버 관리가 용이하고 주소(라우팅) 구분이 편리하다.
* **응답:** 클라이언트에게 응답을 보낼 때 **`res.send()`** 메서드를 사용한다.
* **미들웨어(Middleware):** Express의 핵심으로, 요청과 응답 사이에서 로직을 처리하는 함수이다.
* **기본 매개변수:** 기본적으로 **`req`, `res`, `next`** 3개의 매개변수를 받는다.
* **`next()`:** 다음 미들웨어로 요청을 넘기는 함수로, 이 호출이 없으면 요청 처리가 중단된다.
* **에러 미들웨어:** **`err`, `req`, `res`, `next`** 4개의 매개변수를 처리한다.
* **메서드 체이닝:** `res` 객체의 메서드는 체이닝을 지원하여 코드를 간결하게 작성할 수 있다.

---

## 📁 3. 정적 파일 및 라우팅

* **정적 파일:** **`express.static()`** 미들웨어를 사용해 HTML, CSS, 이미지 등 변하지 않는 파일을 제공한다.
* **보안:** 정적 파일 경로를 공개해도 서버의 실제 파일 경로를 외부에 노출하지 않아 보안에 유리하다. `fs.readFile` 같은 별도 처리 없이 Express가 자동으로 파일 요청을 처리한다.
* **라우터 분리:** `app.get()` 등의 라우팅 처리를 `express.Router()`로 분리하여 별도의 JS 파일로 관리하고, `app.use()`로 연결한다.
* **404 응답 처리:** 모든 라우터가 처리하지 못한 요청은 **가장 밑에** 위치한 미들웨어에서 404 상태 코드로 응답하도록 처리한다.
* **에러 처리 미들웨어:** 404 응답 미들웨어 **다음**에 에러 처리 미들웨어를 두어 내부 서버 에러를 처리한다.

---

## 🔒 4. 데이터 및 보안 처리 (쿠키, 세션, 파일)

### 🍪 쿠키 (Cookie)
* **`cookie-parser`:** 이 미들웨어를 사용하면 **`req.cookies`** 객체를 생성하여 쿠키에 접근한다.
* **서명(Signed Cookie):** 쿠키 위조를 막기 위해 비밀 키를 이용한 **서명** 값을 쿠키에 붙여 서버가 만든 것인지 확인한다.
* **삭제:** **`res.clearCookie()`** 사용 시 **쿠키 설정 당시 사용한 옵션**을 동일하게 제공해야 한다.

### 🔑 세션 (Session)
* **`express-session`:** 서버에 데이터를 저장하고 클라이언트에게는 **세션 ID**만 발급하는 방식이다.
* **설정:** 세션 설정을 인수로 받는다.
* **`saveUninitialized`:** 초기화되지 않은 세션을 저장할지 설정하는 옵션이다.
* **기본 이름:** 세션 쿠키의 기본 이름은 **`connect.sid`**이다.

### 💾 요청 본문 (Body) 및 멀티파일 처리
* **데이터 형식:** Express는 `express.json()`과 `express.urlencoded()`를 이용해 **`raw`, `text`, `encoded`** 형식의 데이터를 해석하여 **`req.body`**에 추가한다.
* **`multer`:** **멀티파트(Multipart/form-data)** 형식의 데이터를 처리하기 위한 미들웨어이다. 파일 업로드를 쉽게 처리한다.
* **`storage`:** `multer` 설정에서 파일의 **저장 경로**와 **파일 이름**을 지정한다.
* **`req.files`:** 파일 업로드 결과는 **`req.files`** 배열에 담긴다.
* **`multer.none()`:** 파일 업로드 없이 멀티파트 형식으로 **`req.body`** 데이터만 보낼 때 사용한다.

---

## 🎨 5. 템플릿 엔진 (Pug, Nunjucks)

* **템플릿 엔진:** 동적인 데이터를 삽입하여 HTML을 렌더링하는 데 사용한다.

### 💚 Pug (구 Jade)
* **문법:** `< >`를 사용하지 않고 **들여쓰기**로 구조를 표현한다. 들여쓰기 오류 시 렌더링되지 않는다.
* **출력:** 변수 처리를 하며, 기본적으로 **이스케이프**를 적용한다. 이스케이프를 원치 않으면 `!=`를 사용한다.
* **흐름 제어:** `each`, `for` 등으로 반복문을 지원하며 인덱스도 사용 가능하다.
* **레이아웃:** `extends`와 `block`을 사용하여 공통 레이아웃을 분리 관리한다.

### 🟨 Nunjucks
* **특징:** Mozilla에서 개발했으며, JavaScript 문법과 유사하여 Pug에 익숙하지 않은 사람들에게 추천된다.
* **변수:** `{{ 변수 }}`로 감싸서 출력한다. 이스케이프를 피하려면 `| safe`를 추가한다.
* **특수 문법:** **`{% 명령 %}`** 형태로 사용한다.
* **흐름 제어:** **`{% for in %}`, `{% endfor %}`, `{% if %}`** 등의 형태로 조건문과 반복문을 사용한다.
* **레이아웃:** **`{% extends %}`**, `{% block %}`, `{% endblock %}`으로 레이아웃을 구성한다.

---

## 🛡️ 6. 에러 처리 (배포 환경)

* **보안:** 배포 환경에서는 보안 취약점을 막기 위해 사용자에게 **에러 스택 트레이스**를 노출하지 않고 **에러 메시지**만 표시하도록 처리한다.
